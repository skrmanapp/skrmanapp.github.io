<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title></title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/icon" href="assets/images/favicon.ico"/>
    <!-- Font Awesome -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Slick slider -->
    <link href="assets/css/slick.css" rel="stylesheet">
    <!-- Theme color -->
    <link id="switcher" href="assets/css/theme-color/default-theme.css" rel="stylesheet">


    <!-- Main Style -->
    <link href="appstyle.css" rel="stylesheet">




    <!-- Bootstrap 本地版 -->
    <!--<link href="assets/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<script src="assets/js/bootstrap.min.js"></script>-->



    <!--  Bootstrap CDN版-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


    <!-- Fonts -->

    <!-- Open Sans for body and title font -->



</head>
<body>





<!-- Start main content -->

<main role="main">

    <div class="container-fluid" style="padding-left: 0px;padding-right: 0px">


        <div class="row table-view">


            <!-- head -->
            <div class="col-xs-12 table-head " >
                <p class="col-xs-4 table-head-title">
                    基本资料
                </p>
            </div>
            <!-- head -->


            <!-- row -->
            <div class="  col-xs-12 table-row-m">

                <div class="col-xs-4">
                    <p class="row-title-m" >
                        头像
                    </p>
                </div>
                <div class="col-xs-4"></div>
                <div class="col-xs-4" style="  display: flex;justify-content: flex-end;">
                    <input id="fileSelector" type="file" style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;">
                    <img class="user-avatar" src="https://lazy-1252169987.cos.ap-guangzhou.myqcloud.com/default-avatar.png" alt="User Avatar" id="user-avatar-image">
                </div>
            </div>
            <div class="row-line col-xs-12"></div>
            <!-- row -->



            <!-- row -->

            <div class=" table-row-s col-xs-12">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        昵称
                    </p>
                </div>

                <div class="col-xs-8" style="  display: flex;justify-content: flex-end;">
                    <p id="nickName"   type="text" class="row-text" > </p>
                    <i class="fa fa-angle-right fa-2x row-icon" style="margin-left: 10px"></i>
                </div>
            </div>
            <div class="row-line col-xs-12"></div>

            <!-- row -->


            <!-- row -->

            <div class=" table-row-s col-xs-12">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        性别
                    </p>
                </div>
                <div class="col-xs-4"></div>
                <div class="col-xs-4" style="  display: flex;justify-content: flex-end;">
                    <select name="select" id="sex" class="row-select">
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                    <i class="fa fa-angle-right fa-2x row-icon" style="margin-left: 10px"></i>
                </div>
            </div>
            <div class="row-line col-xs-12" ></div>

            <!-- row -->


            <!-- row -->

            <div class=" table-row-s col-xs-12" id="bind-mobile">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        手机号
                    </p>
                </div>
                <div class="col-xs-8" style="  display: flex;justify-content: flex-end;">
                    <p id="mobilePhone"   type="text" class="row-text" > </p>
                </div>


            </div>
            <div class="row-line col-xs-12"></div>

            <!-- row -->

            <!-- row -->

            <div class=" table-row-s col-xs-12" id="bind-email">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        邮箱
                    </p>
                </div>
                <div class="col-xs-2"></div>
                <div class="col-xs-6" style="  display: flex;justify-content: flex-end;">
                    <p id="email"   type="text" class="row-text" > </p>
                </div>
            </div>
            <div class="row-line col-xs-12"></div>

            <!-- row -->

            <!-- head -->
            <div class="col-xs-12 table-head " >
                <p class="col-xs-4 table-head-title">
                    会员信息
                </p>
            </div>
            <!-- head -->




            <!-- row -->

            <div class=" table-row-s col-xs-12">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        会员信息
                    </p>
                </div>
                <div class="col-xs-2"></div>
                <div class="col-xs-6" style="  display: flex;justify-content: flex-end;font-size: 12px">
                    <p id="vip-level" name="vip-level"  type="text" class="row-text" ></p>
                </div>
            </div>
            <div class="row-line col-xs-12"></div>

            <!-- row -->






            <!-- row -->
            <div class="  col-xs-12 table-row-s" style="display: none;" id="verify-card">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        欢迎使用SKR
                    </p>
                </div>

                <div class="col-xs-8" style="  display: flex;justify-content: flex-end;">
                    <div class="vip-button" id="vip-button-text">续费会员</div>
                </div>
            </div>
            <div class="row-line col-xs-12"></div>
            <!-- row -->


            <!-- head -->
            <div class="col-xs-12 table-head " >
                <p class="col-xs-4 table-head-title">
                    其他
                </p>
            </div>
            <!-- head -->
            <!-- row -->

            <div class=" table-row-s col-xs-12"  id="bind-wechat">

                <div class="col-xs-8">
                    <p class="row-title-s" >
                        绑定微信（旧版本老用户）
                    </p>
                </div>

                <div class="col-xs-4" style="  display: flex;justify-content: flex-end;">
                    <p   type="text" class="row-text"> </p>
                    <i class="fa fa-angle-right fa-2x row-icon"></i>
                </div>
            </div>
            <div class="row-line col-xs-12" ></div>

            <!-- row -->
            <!-- row -->

            <div class=" table-row-s col-xs-12" id="test-push" style="display: none;">

                <div class="col-xs-4">
                    <p class="row-title-s" >
                        测试推送
                    </p>
                </div>
                <div class="col-xs-4"></div>
                <div class="col-xs-4" style="  display: flex;justify-content: flex-end;">
                    <p   type="text" class="row-text"> </p>
                    <i class="fa fa-angle-right fa-2x row-icon"></i>
                </div>
            </div>
            <div class="row-line col-xs-12" ></div>

            <!-- row -->

        </div>



    </div>




    </div>



    <!--<div class="row " style="margin-top: 50px">-->
    <!--<div class="col-xs-1"> </div>-->
    <!--<button id="add-button" type="button" class="col-xs-10 table-button">保存</button>-->
    <!--<div class="col-xs-1"> </div>-->
    <!--</div>-->


</main>

<!-- End main content -->




<!-- jQuery library -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<!--<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>-->
<!-- tool library -->
<script src="assets/js/tool.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- we ui -->
<link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.0.1/weui.min.css">
<script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>
<script src="assets/js/Bmob-2.2.2.min.js"></script>

<script type="text/javascript">

    jQuery(document).ready(function($){

        Bmob.initialize("f588a519c5f04f8e", "skrman");
        var auth = "null";
        auth = UrlParm.parm("auth");
        var vip = "null"
        var isEmailBind = true
        var isPhoneBind = true
        var tapCount = 5



        if(!auth || auth == 'null'){
            weui.alert('进入参数错误！');
            return
        }


        function reloadForm() {
            //读取数据

            <!--==========================网络请求============================-->
            var requestData = {
                "auth":auth
            }
            var dataStr =  JSON.stringify(requestData)
            console.log(dataStr)
            $.ajax({
                type: "post", //提交方式
                url: request_url + '/UserInfoGet',//路径
                crossDomain: true,//跨域
                dataType: 'json',
                headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                data: dataStr,//数据，这里使用的是Json格式进行传输
                success: function (result) {//返回数据根据结果进行相应的处理
                    console.log('result');
                    console.log(result);
                    if (result.errcode == 0) {
                        $("#user-avatar-image").attr('src',result.result.Avatar);
                        $("#nickName").html(result.result.NickName)

                        let _MobilePhone =  result.result.MobilePhone
                        $("#mobilePhone").html(_MobilePhone)
                        if(_MobilePhone.indexOf("绑定")>-1){
                            isPhoneBind = false;
                        }
                        let _Email =  result.result.Email
                        $("#email").html(_Email)
                        if(_Email.indexOf("绑定")>-1){
                            isEmailBind = false;
                        }
                        $("#vip-level").html(result.result.VipInfo)
                        vip = result.result.Vip
                        if(vip!='null'){
                            $("#test-push").css("display","unset");
                            $("#bind-wechat").css("display","none");
                        }
                        $("#verify-card").css("display","unset");
                        if(vip=='null'){
                            $("#vip-button-text").html("卡券兑换")
                        }
                        if(vip=='base'){
                            $("#vip-button-text").html("升级会员")
                        }
                        if(vip=='super'){
                            $("#vip-button-text").html("续费会员")
                        }
                    } else {
                        weui.alert(result.errmsg)
                    }

                },
                error: (err, type) => {

                    weui.alert(err.statusText)
                },


            });
            <!--==========================网络请求============================-->

        }
        reloadForm();



        $("#vip-level").click(function(){

            tapCount -= 1
            if(tapCount<0){
                window.location.href = "bind-wechat.html?auth="+auth;
            }


        });
        $("#verify-card").click(function(){
            if(vip=='null'){
                window.location.href = "verify-card-new.html?auth="+auth;
            }else{
                window.location.href = "verify-card-continue.html?auth="+auth;
            }



        });

        $("#test-push").click(function(){

            <!--==========================网络请求============================-->
            window.location.href = "push-test.html?auth="+auth+"&platform=ios3";

        });



        $("#user-avatar-image").click(function(){

            $("#fileSelector").val('');
            $("#fileSelector").trigger("click");
        });

        $("#bind-wechat").click(function(){
            // 二次确认
            if(vip == "super"){
                weui.alert("您已经是最高会员")
            }else{
                window.location.href = "bind-wechat.html?auth="+auth;
            }
        });


        $("#bind-email").click(function(){
            // 二次确认
            console.log(isEmailBind)
            if(!isEmailBind){
                window.location.href = "bind-email.html?auth="+auth;
            }
        });







        const fileUploadControl = document.getElementById('fileSelector');
        fileUploadControl.onchange = () => {
            console.log(fileUploadControl.files)
            const pic = fileUploadControl.files[0]
            var  file;
            if(pic.size>500000){
                weui.alert('文件太大啦~请压缩后上传');
                return;
            }

            if(pic.type=='image/png' || pic.type=='image/jpeg'){
                file  = Bmob.File(pic.name, pic);
                file.save().then(res => {
                    updateAvatar(res[0].url)
                })
            }else{
                weui.alert('文件格式不对，请使用PNG,JPG格式');
            }
        }
        function updateAvatar(Avatar) {
            //读取数据
            console.log(Avatar)
            var requestData = {
                "value":Avatar,
                "type":"Avatar",
                "auth":auth
            }
            var dataStr =  JSON.stringify(requestData)
            $.ajax({
                type: "post", //提交方式
                url: request_url + '/UserInfoUpdate',//路径
                crossDomain: true,//跨域
                dataType: 'json',
                headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                data: dataStr,//数据，这里使用的是Json格式进行传输
                success: function (result) {//返回数据根据结果进行相应的处理
                    if (result.errcode == 0) {
                        $("#user-avatar-image").attr('src',Avatar);
                    } else {
                        weui.alert(result.result)
                    }

                },
                error: (err, type) => {

                    weui.alert(err.statusText+"网络错误请联系客服")
                },


            });
            <!--==========================网络请求============================-->

        }



        $("#nickName").click(function(){
            // 二次确认
            window.location.href = "user-update-info.html?auth="+auth;
        });

        $("#sex").change(function(){
            // 二次确认
            localStorage.setItem('user_sex',  $("#sex").val());
        });

        var user_sex = localStorage.getItem('user_sex');
        if (user_sex != null){
            $("#sex").val(user_sex)
        }
    })












</script>




</body>
</html>